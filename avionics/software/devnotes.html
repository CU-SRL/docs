<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Development Notes - CU Sounding Rocket Lab Avionics Documentation</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

        <!-- MathJax -->
        <script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">CU Sounding Rocket Lab Avionics Documentation</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/CU-SRL/docs" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/CU-SRL/docs/edit/main/src/avionics/software/devnotes.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="developing-fprime"><a class="header" href="#developing-fprime">Developing Fprime</a></h1>
<p>[TO BE UPDATED]</p>
<p>This page will act as a top-down walkthrough of what the deployment development process looks like. New deployments can be created for any intended purpose, however for the time-being we make our changes in Ref for simplicity, as much of the setup is already done. Within the deployment, there are a variety of components, connected with a topology. When adding a new component (say, for a sensor), we need to create a directory within the deployment:</p>
<h1 id="adding-a-new-sensor"><a class="header" href="#adding-a-new-sensor">Adding a new sensor</a></h1>
<p>The process for adding a new sensor can be broken down as follows</p>
<ol>
<li>Create sensor dir with fpp, CMake, cpp, and hpp files</li>
<li>Add it to the deployment CMake file, and fill out component CMake file</li>
<li>Run <code>touch &lt;componentname&gt;ComponentImpl.cpp</code> and <code>touch &lt;componentname&gt;ComponentImpl.hpp</code>. This creates "invisible" versions of the file, so that they exist. Trying to implement without these files touched could cause issues.</li>
<li>After fully filling out the fpp, <code>fprime-util impl</code> the component (it should build without error at this point)
<ul>
<li>The Tlm is recomended to run with <code>on change</code> <a href="https://fprime-community.github.io/fpp/fpp-users-guide.html#Defining-Components_Telemetry_Update-Frequency">link</a></li>
</ul>
</li>
<li>This should have produced cpp and hpp file templates. Just rename these to the ComponentImpl.cpp and hpp files you had previously created.</li>
<li>Include the component in <code>Top/Components.hpp</code> along with the extern reference</li>
<li>Include the compeonet in <code>Top/RefTopologyAc.hpp</code></li>
<li>Add the instance to <code>Top/instances.fpp</code></li>
<li>Add the instance and connections to <code>Top/topology.fpp</code></li>
<li>Fill out and complete the cpp and hpp files</li>
<li>Comment the functionality, then make sure it builds</li>
<li>Ensure the pins are configured correctly with <code>config-pin</code></li>
</ol>
<h1 id="configuring-drivers"><a class="header" href="#configuring-drivers">Configuring Drivers</a></h1>
<p>When implementing drivers, be sure to do the following:</p>
<ol>
<li>Look into the both the driver function handlers, as well as the driver ports</li>
<li>In the component fpp file, include the corresponding driver ports, and add any relevant events if desired</li>
<li>In <code>topology.fpp</code>, include the instance of the driver, as well as add the connections for whichever devices are using it</li>
<li>In <code>instances.fpp</code>, again create the instance of the driver, but also add any and all specifications for initialization such as base id, type, and location (remember to leave room for offset for ids)
<ul>
<li>
<p>In this file we also chose to make our open calls for said driver,using the following syntax to insert cpp code into our fpp file:</p>
<p><code>phase Fpp.ToCpp.Phases.configComponents """ {insert code here} """</code></p>
</li>
<li>
<p>Look <a href="https://fprime-community.github.io/fpp/fpp-users-guide.html#Defining-Component-Instances_Init-Specifiers">here</a> for more information on every phase, and their intended uses</p>
</li>
</ul>
</li>
<li>In <code>Component.hpp</code>, include componentimpl header file for the driver and add the driver extern</li>
<li>In <code>Topology.cpp</code>, add the component impl, initialize the component, and do any necessary checks for the previously metioned open call</li>
</ol>
<h1 id="bbb-notes"><a class="header" href="#bbb-notes">BBB Notes</a></h1>
<p>The bashrc used:</p>
<pre><code class="language-bash">alias route="sudo route add default g2 192.168.7.1"
alias runDep"chmod 777 ~/Ref; ./Ref -1 192.168.7.1 -p 50000"
</code></pre>
<blockquote>
<p>make sure pins are configured properly with config-pin &lt;pin number&gt; &lt;pin mode&gt;</p>
</blockquote>
<p>check i2c device connections with</p>
<pre><code class="language-bash">i2c-detect -y -r &lt;bus-number&gt;
</code></pre>
<h1 id="cross-compilation"><a class="header" href="#cross-compilation">Cross-Compilation</a></h1>
<p>The BeagleBone uses an arm-32 architecture. As such, the cross compilation steps from <a href="https://nasa.github.io/fprime/Tutorials/CrossCompilationSetup/CrossCompilationSetupTutorial.html">this tutorial</a>.</p>
<p>FURTHER NOTES:</p>
<p>The bbb toolchain is now missing from the dev branches, if you are using the Deb 10 VM provided by avionics add the following to <code>srlFp/cmake/toolchain/bbb.cmake</code></p>
<pre><code class="language-cmake">set(CMAKE_SYSTEM_NAME           Linux)
SET(CMAKE_SYSTEM_VERSION        1)
SET(CMAKE_SYSTEM_PROCESSOR      arm)

set(CMAKE_C_COMPILER "/opt/gcc-arm-linux/bin/arm-linux-gnueabihf-gcc")
set(CMAKE_CXX_COMPILER "/opt/gcc-arm-linux/bin/arm-linux-gnueabihf-g++")

set(CMAKE_FIND_ROOT_PATH  "/opt/gcc-arm-linux/arm-linux-gnueabihf")

set(CMAKE_FIND_ROOT_PATH_MODE_PROGRAM NEVER)
set(CMAKE_FIND_ROOT_PATH_MODE_LIBRARY ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_INCLUDE ONLY)
set(CMAKE_FIND_ROOT_PATH_MODE_PACKAGE ONLY)
</code></pre>
<blockquote>
<p>assumes the installed binutils are found in /opt but can be installed anywhere as long as the path is adjusted</p>
</blockquote>
<p>If you are interested in using Clang, look at <a href="https://stackoverflow.com/questions/7031126/switching-between-gcc-and-clang-llvm-using-cmake">this</a>. Currently we use gcc and the arm binutils to cross-compile but are interested in eventually switichng to clang for both performance and convenience.</p>
<h1 id="documentation"><a class="header" href="#documentation">Documentation</a></h1>
<p>We have a history of poor documentation in SRL, and as developers in general. We are solving that with 2 exersices: 1. Suggesting that people comment their code using the doxygen style, using plugins and 2. Realizing that FPrime is complex enough that trying to remember why you did something is hard.</p>
<p>Our standard style for funciton comments uses the <code>JAVADOC</code>/<code>C-STYLE</code> as shown here with a simple addition function:</p>
<pre><code class="language-c++">/**
* \brief (Short description here)
* (Longer in depth description here)
* 
* \param x (what is this input)
* \param y (what is this input)
* \return (what is the return)
*/ 
int function(int x, int y){
        int temp; /*  What does this member var do   */
        tmp = x+y
        return tmp;
}
</code></pre>
<p>It is also important to use annotations in the fpp code in order for the autocoder to create comments for you, see <a href="https://fprime-community.github.io/fpp/fpp-users-guide.html#Writing-Comments-and-Annotations">here</a> for more information.</p>
<p>When merged into main, doxygen automatically runs and executes on the documentation branch.</p>
<h2 id="buffers"><a class="header" href="#buffers">Buffers</a></h2>
<p>An important aspect to note about the linux communication drivers provided by Fprime is that they take Fprime Buffers as inputs, as opposed to standard buffers made in C. Using Fprime Buffers is a three step process: allocating out the required space, serializing it with the relevant data, then deallocating said memory. A more in depth explanation on this process can be found  <a href="https://nasa.github.io/fprime/UsersGuide/best/dynamic-memory.html">here</a>.</p>
<h2 id="toplogies"><a class="header" href="#toplogies">Toplogies</a></h2>
<p>Depending on how old the documentation you are looking at, a topology may be using direct graph specifiers. For most connections however (in the <code>topology.fpp</code>), you can use pattern graph specifiers. This will make your life a whole lot easier.</p>
<h2 id="running-the-groundstation-on-windows"><a class="header" href="#running-the-groundstation-on-windows">Running the Groundstation on Windows</a></h2>
<p>If you are trying to connect to the beaglebone and run the groundstation on your local machine, and then collect data, you will need to do a couple of things. Go to Windows Defender Firewall, then advanced settings, adn from there Inbound Rules. Select the four rules that contain</p>
<h2 id="nice-aliases-to-have"><a class="header" href="#nice-aliases-to-have">Nice aliases to have</a></h2>
<p>There are certain aliases that are nice to have that make quality life a lot better in terms of running the avionics:</p>
<p>For all aliases, these are just example paths, use whatever works best for you.</p>
<p>alias fprime="source <del>/fprime-venv/bin/activate"
alias bbbconnect="ssh debian@192.168.7.2"
alias sendover="scp <del>/SRL/RefTopologyAppDictionary.xml debian@192.168.7.2:</del>/deployment/dict; scp $HOME/SRL/Ref debian@192.168.7.2:</del>/deployment/bin;"
alias runGDS="fprime-gds -n --dictionary ~/SRL/RefTopologyAppDictionary.xml"</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../avionics/software/newmember.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../avionics/software/usefullinks.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../avionics/software/newmember.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../avionics/software/usefullinks.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->


    </div>
    </body>
</html>
